<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Paebbl – CO₂ Savings Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #111827;
      background: #f3f4f6;
    }
    body {
      max-width: 960px;
      margin: 2rem auto;
      padding: 0 1rem 3rem;
    }
    h1 {
      font-size: 1.9rem;
      margin-bottom: 0.25rem;
    }
    .subtitle {
      color: #6b7280;
      margin-bottom: 1.5rem;
      max-width: 650px;
    }
    .layout {
      display: grid;
      gap: 1.5rem;
    }
    @media (min-width: 900px) {
      .layout {
        grid-template-columns: 1.25fr 1fr;
        align-items: flex-start;
      }
    }
    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 1.25rem 1.5rem;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.06);
      border: 1px solid #e5e7eb;
    }
    .card h2 {
      font-size: 1.1rem;
      margin-bottom: 0.25rem;
    }
    .card p.desc {
      font-size: 0.9rem;
      color: #6b7280;
      margin-bottom: 1rem;
    }
    label {
      display: block;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 0.45rem 0.6rem;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 0.95rem;
      box-sizing: border-box;
    }
    .field {
      margin-bottom: 0.8rem;
    }
    .row-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem;
    }
    .slider-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    input[type="range"] {
      flex: 1;
    }
    .slider-value {
      font-size: 0.9rem;
      min-width: 3.5rem;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }
    .note {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 0.25rem;
    }
    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.75rem;
      font-size: 0.9rem;
    }
    .checkbox-row label {
      margin: 0;
      font-weight: 500;
    }
    .results-main {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.25rem;
      text-align: center;
    }
    .badge {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      background: #ecfdf5;
      color: #166534;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .big-number {
      font-size: 2.3rem;
      font-weight: 800;
      font-variant-numeric: tabular-nums;
    }
    .big-number span.small {
      font-size: 1rem;
      font-weight: 500;
      margin-left: 0.3rem;
      color: #6b7280;
    }
    .delta-text {
      font-size: 0.95rem;
      color: #4b5563;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      font-size: 0.8rem;
      font-weight: 500;
    }
    .pill.red {
      background: #fee2e2;
      color: #b91c1c;
    }
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem;
      margin-top: 1.25rem;
      font-size: 0.9rem;
    }
    .summary-item {
      padding: 0.75rem;
      border-radius: 10px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      text-align: left;
    }
    .summary-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #9ca3af;
      margin-bottom: 0.25rem;
    }
    .summary-value {
      font-size: 1.0rem;
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }
    .summary-sub {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .error {
      margin-top: 0.5rem;
      font-size: 0.85rem;
      color: #b91c1c;
    }
  </style>
</head>
<body>
  <h1>CO₂ savings with Paebbl</h1>
  <p class="subtitle">
    Enter the rough masses of your concrete mix per m³, select the cement type, and choose
    a Paebbl replacement level to estimate the CO₂e reduction.
  </p>

  <div class="layout">
    <!-- LEFT: Inputs -->
    <div class="card">
      <h2>1. Baseline mix</h2>
      <p class="desc">
        Masses can be approximate per m³ (or per batch, as long as you compare like-for-like).
      </p>

      <div class="field">
        <label for="cementType">Cement type</label>
        <select id="cementType">
          <option value="cement_cem1">CEM I</option>
          <option value="cement_cem2">CEM II</option>
          <option value="cement_cem3">CEM III</option>
        </select>
      </div>

      <div class="row-2">
        <div class="field">
          <label for="cementMass">Cement (kg)</label>
          <input id="cementMass" type="number" min="0" step="1" value="300" />
        </div>
        <div class="field">
          <label for="limestoneMass">Limestone filler (kg)</label>
          <input id="limestoneMass" type="number" min="0" step="1" value="50" />
        </div>
      </div>

      <div class="row-2">
        <div class="field">
          <label for="sandMass">Sand (kg)</label>
          <input id="sandMass" type="number" min="0" step="1" value="800" />
        </div>
        <div class="field">
          <label for="gravelMass">Gravel (kg)</label>
          <input id="gravelMass" type="number" min="0" step="1" value="950" />
        </div>
      </div>

      <div class="row-2">
        <div class="field">
          <label for="admixtureMass">Admixture (kg)</label>
          <input id="admixtureMass" type="number" min="0" step="0.1" value="5" />
        </div>
        <div class="field">
          <label for="waterMass">Water (kg)</label>
          <input id="waterMass" type="number" min="0" step="1" value="180" />
        </div>
      </div>

      <p class="note">
        Default values are indicative only. Adjust to fit your mix design.
      </p>

      <hr style="margin: 1.25rem 0; border: none; border-top: 1px solid #e5e7eb" />

      <h2>2. Paebbl replacement</h2>
      <p class="desc">How much of the cement do you replace with Paebbl?</p>

      <div class="field">
        <label for="replacementPct">Replacement percentage</label>
        <div class="slider-row">
          <input id="replacementPct" type="range" min="0" max="70" step="1" value="40" />
          <div class="slider-value"><span id="replacementPctValue">40</span>%</div>
        </div>
        <p class="note">Range 0–70%. Example only – use values relevant for your system.</p>
      </div>

      <div class="checkbox-row">
        <input id="includeStorageNet" type="checkbox" />
        <label for="includeStorageNet">
          Show net climate impact including permanent CO₂ storage
        </label>
      </div>

      <div id="errorMsg" class="error" style="display:none;"></div>
    </div>

    <!-- RIGHT: Results -->
    <div class="card">
      <h2>3. Results per m³ (A1–A3)</h2>
      <p class="desc">
        Conservative view: process emissions (A1–A3) with CO₂ storage shown separately.
      </p>

      <div class="results-main">
        <div class="badge">A1–A3 reduction</div>
        <div class="big-number">
          <span id="reductionPct">0.0</span>%
          <span class="small">vs. baseline</span>
        </div>
        <div class="delta-text">
          <span id="reductionAbs">0.0</span> kg CO₂e/m³ saved
        </div>

        <div class="pill" id="storagePill" style="display:none;">
          Storage: <span id="storedCO2">0.0</span> kg CO₂ permanently stored
        </div>

        <div class="pill red" id="netPill" style="display:none;">
          Net climate impact: <span id="netImpact">0.0</span> kg CO₂e/m³
          (<span id="netPct">0.0</span>% vs. baseline)
        </div>
      </div>

      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-label">Baseline mix</div>
          <div class="summary-value">
            <span id="gwpBaseline">0.0</span> kg CO₂e/m³
          </div>
          <div class="summary-sub">
            All materials, current cement type.
          </div>
        </div>
        <div class="summary-item">
          <div class="summary-label">Paebbl mix</div>
          <div class="summary-value">
            <span id="gwpPaebbl">0.0</span> kg CO₂e/m³
          </div>
          <div class="summary-sub">
            With <span id="replacementSummary">0</span>% Paebbl replacement (A1–A3 only).
          </div>
        </div>
      </div>

      <p class="note" style="margin-top: 1rem;">
        This tool is indicative only. For reporting or project-specific LCAs, use
        detailed mix designs and verified EPD data.
      </p>
    </div>
  </div>

  <script>
    // --------------------------------------------------------------------
    // Paebbl Carbon Reduction Calculator Engine – JS version
    // --------------------------------------------------------------------

    // Default emission factors (kg CO2e/kg)
    const DEFAULT_EMISSION_FACTORS = {
      cement_cem1: 0.857,
      cement_cem2: 0.657,
      cement_cem3: 0.457,
      paebbl: 0.0,      // A1-A3 footprint (storage shown separately)
      limestone: 0.12,
      sand: 0.00237,
      gravel: 0.0101,
      admix_generic: 1.5,
      water: 0.0
    };

    // Optional: labels if you ever want to show a breakdown
    const MATERIAL_LABELS = {
      cement_cem1: "CEM I",
      cement_cem2: "CEM II",
      cement_cem3: "CEM III",
      paebbl: "Paebbl",
      limestone: "Limestone filler",
      sand: "Sand",
      gravel: "Gravel",
      admix_generic: "Admixture",
      water: "Water"
    };

    // input: { baseline: MaterialInput[], paebbl: MaterialInput[], storageFactorPerKgPaebbl?, includeStorageInNet? }
    function calculate(input) {
      const baseline = input.baseline || [];
      const paebbl = input.paebbl || [];
      const storageFactorPerKgPaebbl = (typeof input.storageFactorPerKgPaebbl === "number")
        ? input.storageFactorPerKgPaebbl
        : 0.9; // default from TS
      const includeStorageInNet = !!input.includeStorageInNet;

      // Baseline contributions
      const baselineContributions = baseline.map((mat) => {
        const ef = (typeof mat.ef === "number")
          ? mat.ef
          : (DEFAULT_EMISSION_FACTORS[mat.key] || 0);
        const gwp = mat.mass * ef;
        return {
          key: mat.key,
          label: MATERIAL_LABELS[mat.key] || mat.key,
          gwp,
          mass: mat.mass,
          ef
        };
      });
      const gwpBaseline = baselineContributions.reduce((sum, c) => sum + c.gwp, 0);

      // Paebbl contributions
      const paebblContributions = paebbl.map((mat) => {
        const ef = (typeof mat.ef === "number")
          ? mat.ef
          : (DEFAULT_EMISSION_FACTORS[mat.key] || 0);
        const gwp = mat.mass * ef;
        return {
          key: mat.key,
          label: MATERIAL_LABELS[mat.key] || mat.key,
          gwp,
          mass: mat.mass,
          ef
        };
      });
      const gwpPaebbl = paebblContributions.reduce((sum, c) => sum + c.gwp, 0);

      // Reduction (A1–A3 only)
      const reductionAbs = gwpBaseline - gwpPaebbl;
      const reductionPct = gwpBaseline > 0 ? (reductionAbs / gwpBaseline) * 100 : 0;

      // CO2 stored (separate from GWP)
      const paebblMaterial = paebbl.find((m) => m.key === "paebbl");
      const co2Stored = paebblMaterial
        ? paebblMaterial.mass * storageFactorPerKgPaebbl
        : 0;

      // Net climate impact (optional)
      const netClimateImpact = includeStorageInNet
        ? (gwpPaebbl - co2Stored)
        : undefined;

      return {
        gwpBaseline,
        gwpPaebbl,
        reductionAbs,
        reductionPct,
        co2Stored,
        netClimateImpact,
        contributions: {
          baseline: baselineContributions,
          paebbl: paebblContributions
        }
      };
    }

    // Generate Paebbl mix from baseline by replacing cement with Paebbl
    function generatePaebblMix(baseline, replacementPct, cementKey = "cement_cem3") {
      const cement = baseline.find((m) => m.key === cementKey);
      if (!cement) {
        throw new Error("Cement material " + cementKey + " not found in baseline");
      }

      const paebblMass = (cement.mass * replacementPct) / 100;
      const remainingCement = cement.mass - paebblMass;

      const paebblMix = baseline.map((m) => {
        if (m.key === cementKey) {
          return Object.assign({}, m, { mass: remainingCement });
        }
        return Object.assign({}, m);
      });

      paebblMix.push({ key: "paebbl", mass: paebblMass });

      return paebblMix;
    }

    // --------------------------------------------------------------------
    // UI wiring
    // --------------------------------------------------------------------

    const cementTypeEl = document.getElementById("cementType");
    const cementMassEl = document.getElementById("cementMass");
    const limestoneMassEl = document.getElementById("limestoneMass");
    const sandMassEl = document.getElementById("sandMass");
    const gravelMassEl = document.getElementById("gravelMass");
    const admixtureMassEl = document.getElementById("admixtureMass");
    const waterMassEl = document.getElementById("waterMass");

    const replacementPctEl = document.getElementById("replacementPct");
    const replacementPctValueEl = document.getElementById("replacementPctValue");
    const includeStorageNetEl = document.getElementById("includeStorageNet");

    const errorMsgEl = document.getElementById("errorMsg");

    const gwpBaselineEl = document.getElementById("gwpBaseline");
    const gwpPaebblEl = document.getElementById("gwpPaebbl");
    const reductionAbsEl = document.getElementById("reductionAbs");
    const reductionPctEl = document.getElementById("reductionPct");
    const replacementSummaryEl = document.getElementById("replacementSummary");

    const storagePillEl = document.getElementById("storagePill");
    const storedCO2El = document.getElementById("storedCO2");

    const netPillEl = document.getElementById("netPill");
    const netImpactEl = document.getElementById("netImpact");
    const netPctEl = document.getElementById("netPct");

    function toNumber(el) {
      const v = parseFloat(el.value);
      return isNaN(v) ? 0 : v;
    }

    function format(x, decimals) {
      return Number(x).toFixed(decimals);
    }

    function recalc() {
      const cementKey = cementTypeEl.value;
      const cementMass = toNumber(cementMassEl);
      const limestoneMass = toNumber(limestoneMassEl);
      const sandMass = toNumber(sandMassEl);
      const gravelMass = toNumber(gravelMassEl);
      const admixtureMass = toNumber(admixtureMassEl);
      const waterMass = toNumber(waterMassEl);
      const replacementPct = parseFloat(replacementPctEl.value) || 0;
      const includeStorageNet = includeStorageNetEl.checked;

      replacementPctValueEl.textContent = replacementPct.toString();
      replacementSummaryEl.textContent = replacementPct.toString();

      if (cementMass <= 0) {
        errorMsgEl.textContent = "Please enter a positive mass for cement.";
        errorMsgEl.style.display = "block";
        return;
      } else {
        errorMsgEl.style.display = "none";
      }

      // Build baseline materials
      const baseline = [
        { key: cementKey, mass: cementMass },
        { key: "limestone", mass: limestoneMass },
        { key: "sand", mass: sandMass },
        { key: "gravel", mass: gravelMass },
        { key: "admix_generic", mass: admixtureMass },
        { key: "water", mass: waterMass }
      ];

      let paebblMix;
      try {
        paebblMix = generatePaebblMix(baseline, replacementPct, cementKey);
      } catch (e) {
        errorMsgEl.textContent = e.message || String(e);
        errorMsgEl.style.display = "block";
        return;
      }

      const result = calculate({
        baseline: baseline,
        paebbl: paebblMix,
        storageFactorPerKgPaebbl: 0.9, // you can change this if needed
        includeStorageInNet: includeStorageNet
      });

      gwpBaselineEl.textContent = format(result.gwpBaseline, 1);
      gwpPaebblEl.textContent = format(result.gwpPaebbl, 1);
      reductionAbsEl.textContent = format(result.reductionAbs, 1);
      reductionPctEl.textContent = format(result.reductionPct, 1);

      if (result.co2Stored && result.co2Stored > 0.0001) {
        storagePillEl.style.display = "inline-flex";
        storedCO2El.textContent = format(result.co2Stored, 1);
      } else {
        storagePillEl.style.display = "none";
      }

      if (typeof result.netClimateImpact === "number") {
        netPillEl.style.display = "inline-flex";
        netImpactEl.textContent = format(result.netClimateImpact, 1);
        const gwpBaseline = result.gwpBaseline;
        const netPct = gwpBaseline > 0
          ? ((gwpBaseline - result.netClimateImpact) / gwpBaseline) * 100
          : 0;
        netPctEl.textContent = format(netPct, 1);
      } else {
        netPillEl.style.display = "none";
      }
    }

    [
      cementTypeEl,
      cementMassEl,
      limestoneMassEl,
      sandMassEl,
      gravelMassEl,
      admixtureMassEl,
      waterMassEl,
      replacementPctEl,
      includeStorageNetEl
    ].forEach((el) => {
      el.addEventListener("input", recalc);
      el.addEventListener("change", recalc);
    });

    // Initial calculation
    recalc();
  </script>
</body>
</html>
